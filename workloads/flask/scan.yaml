apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-scaning
spec: 
  metrics: 
  - name: flask-scaning
    provider: 
      job: 
        spec: 
          ttlSecondsAfterFinished: 86400
          template: 
            spec: 
              serviceAccountName: kubescape-scan 
              containers: 
                - name: kubescape
                  image: acr4nt534.azurecr.io/kubescape
                  command: ["/busybox/sh", "-c"]
                  args: 
                    -> 
                      echo "Kubescape is running"
                      kubescape scan workload --severity-theshold=high --namespace=flask-ks deployment/flask.deployment
                  env: 
                    - name: VERBOSE
                      value: "on"
                    - name: FRAMEWORKS
                      value: MITRE
              restartPolicy: Never
          backoffLimit: 1        
                    

